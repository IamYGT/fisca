import{u as A,r as g,a as E,j as e,M as U,h as w,y as h}from"./app-CzQgzLDV.js";import{A as B}from"./AuthenticatedLayout-DK_-UJtt.js";import{a as _,n as M,d as Q,o as H,p as L,g as S,q as Z,r as G,s as K,t as O,e as W,f as J}from"./index-DnFmWr2M.js";import{PriorityBadge as V}from"./Badges-BPs4J-YJ.js";import X from"./PreviewModal-JIX89cs4.js";import Y from"./StatusSelect-BDe18-aw.js";import z from"./TicketHistoryPanel-FPgvAmo3.js";import"./ApplicationLogo-tpEwtBlH.js";import"./index-BdO7F12x.js";import"./proxy-CgUF6eMH.js";import"./iconBase-aArZRAXf.js";import"./index-C7UQo0Vh.js";import"./menu-0vx0Mz6b.js";import"./portal-ssQOh7ct.js";import"./use-server-handoff-complete-CR0MK-dB.js";const F=({isAdmin:t,message:s,user:l,date:r,attachments:o,quote:p,onPreviewImage:x,formatDate:j})=>e.jsxs("div",{className:`group flex gap-3 p-2 transition-all ${t?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[l.avatar?e.jsx("img",{src:l.avatar,alt:l.name,className:"h-10 w-10 rounded-full object-cover shadow-sm ring-2 ring-white dark:ring-gray-700"}):e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-full shadow-sm ${t?"bg-indigo-100 dark:bg-indigo-900/50":"bg-emerald-100 dark:bg-emerald-900/50"}`,children:e.jsx(S,{className:`h-5 w-5 ${t?"text-indigo-600 dark:text-indigo-400":"text-emerald-600 dark:text-emerald-400"}`})}),t&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 rounded-full bg-indigo-500 p-1",children:e.jsx(G,{className:"h-2.5 w-2.5 text-white"})})]})}),e.jsxs("div",{className:`min-w-0 flex-1 space-y-1.5 rounded-xl p-3 shadow-sm ${t?"bg-indigo-50 dark:bg-indigo-900/20":"bg-emerald-50 dark:bg-emerald-900/20"}`,children:[p&&e.jsx("div",{className:"mb-2 rounded-lg border-l-2 border-gray-300 bg-gray-100 p-2 text-sm text-gray-600 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-400",children:p}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:`text-sm font-medium ${t?"text-indigo-900 dark:text-indigo-100":"text-emerald-900 dark:text-emerald-100"}`,children:l.name}),e.jsx("span",{className:"whitespace-nowrap text-xs text-gray-500 dark:text-gray-400",children:j(r)})]}),e.jsx("div",{className:"text-sm leading-relaxed text-gray-700 dark:text-gray-300",children:s}),o&&o.length>0&&e.jsx("div",{className:"mt-2 space-y-1.5 border-t border-gray-100 pt-2 dark:border-gray-700/50",children:o.map(c=>e.jsx(ee,{attachment:c,onPreview:()=>x(c.url)},c.id))})]})]});function pe({auth:t,ticket:s,statuses:l}){const{t:r,locale:o}=A(),[p,x]=g.useState(!1),[j,c]=g.useState(null),b=g.useRef(null),[,C]=g.useState(s.status),[I,v]=g.useState(!1),{data:i,setData:m,processing:N,reset:R}=E({message:"",status:s.status,attachments:[],quote:""}),$=async a=>{v(!0),w.put(route("admin.tickets.update-status",s.id),{status:a},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{C(a)},onError:()=>{h.error(r("common.error"))},onFinish:()=>{v(!1)}})},k=a=>{m("quote",a),x(!0)},q=async a=>{a.preventDefault();const d=new FormData;d.append("message",i.message),i.quote&&d.append("quote",i.quote),i.attachments.length>0&&i.attachments.forEach((n,y)=>{d.append(`attachments[${y}]`,n)});try{await w.post(route("admin.tickets.reply",s.id),d,{forceFormData:!0,preserveScroll:!0,preserveState:!0,onSuccess:()=>{m("message",""),m("quote",null),m("attachments",[]),x(!1),h.success(r("ticket.replyAdded"))},onError:n=>{console.error("Reply errors:",n),h.error(r("common.error"))}})}catch(n){console.error("Reply failed:",n),h.error(r("common.error"))}},D=a=>{const d=Array.from(a.target.files||[]),n=10*1024*1024,y=["image/jpeg","image/png","image/gif","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],P=d.filter(f=>f.size>n?(h.error(r("ticket.fileTooLarge",{name:f.name})),!1):y.includes(f.type)?!0:(h.error(r("ticket.invalidFileType",{name:f.name})),!1));m("attachments",[...i.attachments,...P])},T=a=>{const d=[...i.attachments];d.splice(a,1),m("attachments",d)},u=g.useCallback(a=>{const d={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1},n={tr:{...d,timeZone:"Europe/Istanbul"},en:{...d,timeZone:"UTC"}};try{return new Date(a).toLocaleDateString(o==="tr"?"tr-TR":"en-US",n[o])}catch(y){return console.error("Date formatting error:",y),a}},[o]);return e.jsxs(B,{auth:{user:{id:t.user.id,name:t.user.name,email:t.user.email,roles:t.user.roles}},header:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:r("ticket.details")})}),children:[e.jsx(U,{title:`${r("ticket.ticket")} #${s.id}`}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8 rounded-2xl bg-white p-8 shadow-sm dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"rounded-xl bg-indigo-50 p-3 dark:bg-indigo-900/30",children:e.jsx(_,{className:"h-6 w-6 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:s.subject}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"font-medium",children:["#",s.id]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:u(s.created_at)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{priority:s.priority}),e.jsx(Y,{currentStatus:s.status,statuses:l,onChange:$,isLoading:I,t:r,ticketId:s.id})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-4",children:[e.jsx("div",{className:"space-y-6 lg:col-span-3",children:e.jsxs("div",{className:"overflow-hidden rounded-xl bg-white shadow-sm dark:bg-gray-800",children:[e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsx(F,{isAdmin:!1,message:s.message,user:s.user,date:s.created_at,attachments:s.attachments,onPreviewImage:c,onQuote:()=>k(s.message),t:r,formatDate:u}),s.replies.map(a=>e.jsx(F,{isAdmin:a.user.id===t.user.id,message:a.message,user:a.user,date:a.created_at,attachments:a.attachments,quote:a.quote,onPreviewImage:c,onQuote:()=>k(a.message),t:r,formatDate:u},a.id))]})}),e.jsx("div",{className:"border-t p-6 dark:border-gray-700",children:p?e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[i.quote&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500",children:r("ticket.quote")})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:i.quote})]}),e.jsx("textarea",{value:i.message,onChange:a=>m("message",a.target.value),className:"w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100",rows:6,placeholder:r("ticket.writeReply")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",ref:b,onChange:D,multiple:!0,className:"hidden",accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx"}),e.jsxs("button",{type:"button",onClick:()=>{var a;return(a=b.current)==null?void 0:a.click()},className:"flex items-center gap-2 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:[e.jsx(H,{className:"h-4 w-4"}),r("ticket.attachFiles")]})]}),i.attachments.length>0&&e.jsx("div",{className:"space-y-2",children:i.attachments.map((a,d)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-2 dark:bg-gray-800",children:[e.jsx("span",{className:"truncate text-sm text-gray-600 dark:text-gray-400",children:a.name}),e.jsx("button",{type:"button",onClick:()=>T(d),className:"text-red-500 hover:text-red-700",children:e.jsx(L,{className:"h-4 w-4"})})]},d))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),R()},className:"px-4 py-2 text-sm text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100",children:r("common.cancel")}),e.jsx("button",{type:"submit",disabled:N||!i.message.trim(),className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-50",children:r(N?"common.sending":"common.send")})]})]}):e.jsx("button",{onClick:()=>x(!0),className:"w-full rounded-xl border-2 border-dashed border-gray-200 px-8 py-6 text-gray-500 transition-colors hover:border-gray-300 hover:text-gray-700 dark:border-gray-700 dark:text-gray-400 dark:hover:border-gray-600 dark:hover:text-gray-300",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:r("ticket.clickToReply")})]})})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-2xl bg-white p-6 shadow-sm dark:bg-gray-800",children:[e.jsxs("h2",{className:"mb-6 flex items-center gap-2 text-lg font-medium text-gray-900 dark:text-gray-100",children:[e.jsx(S,{className:"h-5 w-5 text-gray-400"}),r("ticket.userInfo")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700",children:e.jsx("span",{className:"text-lg font-medium text-gray-600 dark:text-gray-300",children:s.user.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:s.user.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.user.email})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-4 dark:border-gray-700",children:e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("ticket.createdAt")}),e.jsx("dd",{className:"text-sm text-gray-900 dark:text-gray-100",children:u(s.created_at)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("ticket.lastReply")}),e.jsx("dd",{className:"text-sm text-gray-900 dark:text-gray-100",children:u(s.last_reply_at)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("ticket.category")}),e.jsx("dd",{className:"text-sm text-gray-900 dark:text-gray-100",children:r(`ticket.category.${s.category}`)})]})]})})]})]}),e.jsxs("div",{className:"rounded-2xl bg-white p-6 shadow-sm dark:bg-gray-800",children:[e.jsxs("h2",{className:"mb-6 flex items-center gap-2 text-lg font-medium text-gray-900 dark:text-gray-100",children:[e.jsx(Z,{className:"h-5 w-5 text-gray-400"}),r("ticket.history")]}),e.jsx(z,{history:s.history})]})]})]})]})}),e.jsx(X,{isOpen:!!j,imageUrl:j,onClose:()=>c(null)})]})}const ee=({attachment:t,onPreview:s})=>{const l=t.type.startsWith("image/"),r=ae(t.size);return e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-gray-100 bg-white p-2.5 shadow-sm transition-colors hover:border-indigo-200 dark:border-gray-700/50 dark:bg-gray-800/50 dark:hover:border-indigo-700/50",children:[e.jsx("div",{className:"rounded-lg bg-gray-50 p-2 dark:bg-gray-800",children:l?e.jsx(K,{className:"h-4 w-4 text-indigo-500"}):e.jsx(O,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsx("button",{onClick:s,className:"rounded-lg p-1.5 text-gray-500 hover:bg-gray-50 hover:text-indigo-600 dark:hover:bg-gray-800",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx("a",{href:t.url,download:!0,className:"rounded-lg p-1.5 text-gray-500 hover:bg-gray-50 hover:text-indigo-600 dark:hover:bg-gray-800",children:e.jsx(J,{className:"h-4 w-4"})})]})]})},ae=t=>t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(2)} KB`:t<1024*1024*1024?`${(t/(1024*1024)).toFixed(2)} MB`:`${(t/(1024*1024*1024)).toFixed(2)} GB`;export{pe as default};
