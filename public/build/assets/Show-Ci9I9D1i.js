import{u as D,r as f,a as T,j as e,M as $,h as z,y as m}from"./app-CgaCq9nv.js";import{P as A,S as E}from"./Badges-Dd9sKARS.js";import{A as P}from"./AuthenticatedLayout-DpS60fxf.js";import{a as x}from"./ticket_format-D60ae_vA.js";import{g as R,d as _,t as v,e as B,f as M,p as N,o as Q,j as V}from"./index-y9wjzvP5.js";import{m as I}from"./proxy-DFKnN-q_.js";import"./ApplicationLogo-Czs6layN.js";import"./index-9TwP4i1b.js";import"./iconBase-5kt8W0gk.js";import"./index-DNvxNPgT.js";function Z({auth:n,ticket:r,statuses:b}){var y;const{t}=D(),[g,h]=f.useState(null),[u,o]=f.useState(null),{data:i,setData:d,post:w,processing:p,reset:k}=T({message:"",attachments:[],quote:null}),F=s=>{s.preventDefault();const a=new FormData;a.append("message",i.message),i.quote&&a.append("quote",i.quote),i.attachments.forEach((l,c)=>{a.append(`attachments[${c}]`,l)}),w(route("tickets.reply",r.id),{data:a,forceFormData:!0,onSuccess:()=>{k(),o(null),m.success(t("tickets.replySent"))},onError:()=>{m.error(t("common.error"))}})},C=s=>{if(!s)return;const a=Array.from(s).filter(l=>{const c=["image/jpeg","image/png","image/gif","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type),j=l.size<=10*1024*1024;return c||m.error(t("tickets.invalidFileType",{name:l.name})),j||m.error(t("tickets.fileTooLarge",{name:l.name})),c&&j});d("attachments",[...i.attachments,...a])},S=s=>{const a=[...i.attachments];a.splice(s,1),d("attachments",a)},q=s=>{o(s),d("quote",s)};return e.jsxs(P,{auth:{user:{...n.user,roles:n.user.roles||[]}},header:e.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:[t("tickets.ticket")," #",r.id," - ",e.jsx("span",{className:`text-sm ${r.status==="open"?"text-blue-600":r.status==="answered"?"text-green-600":"text-gray-600"}`,children:t(`tickets.status.${r.status}`)})]}),children:[e.jsx($,{title:`${t("tickets.ticket")} #${r.id}`}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6 overflow-hidden rounded-lg bg-white p-6 shadow-sm dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:r.subject}),e.jsxs("div",{className:"mt-1 flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:[t("tickets.createdAt"),":"," ",x(r.created_at)]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[t("tickets.lastReply"),":"," ",x(r.last_reply_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{priority:r.priority}),e.jsx(E,{status:r.status})]})]})}),e.jsx("div",{className:"mb-6 space-y-6",children:r.replies.map(s=>e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`overflow-hidden rounded-lg bg-white p-6 shadow-sm dark:bg-gray-800 ${s.user.id===n.user.id?"ml-auto":"mr-auto"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700",children:e.jsx(R,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.user.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:x(s.created_at)})]})]}),e.jsx("button",{onClick:()=>q(s.message),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(_,{className:"h-4 w-4"})})]}),s.quote&&e.jsx("div",{className:"mt-4 rounded-lg border-l-4 border-gray-200 bg-gray-50 p-4 dark:border-gray-600 dark:bg-gray-700/50",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:s.quote})}),e.jsx("div",{className:"mt-4 whitespace-pre-wrap text-gray-700 dark:text-gray-300",children:s.message}),s.attachments.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:s.attachments.map(a=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-2 dark:bg-gray-700",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"mr-2 h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.type.startsWith("image/")&&e.jsx("button",{onClick:()=>h(a.url),className:"text-gray-400 hover:text-blue-500",children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx("a",{href:a.url,download:!0,className:"text-gray-400 hover:text-blue-500",children:e.jsx(M,{className:"h-4 w-4"})})]})]},a.id))})]},s.id))}),e.jsx("div",{className:"rounded-lg bg-white p-6 shadow-sm dark:bg-gray-800",children:e.jsxs("form",{onSubmit:F,children:[u&&e.jsxs("div",{className:"mb-4 rounded-lg border-l-4 border-gray-200 bg-gray-50 p-4 dark:border-gray-600 dark:bg-gray-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("tickets.quote")}),e.jsx("button",{type:"button",onClick:()=>{o(null),d("quote",null)},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(N,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:u})]}),e.jsx("textarea",{value:i.message,onChange:s=>d("message",s.target.value),className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",rows:6,placeholder:t("tickets.writeReply"),required:!0}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",multiple:!0,onChange:s=>C(s.target.files),className:"hidden",id:"attachments",accept:"image/*,.pdf,.doc,.docx"}),e.jsxs("label",{htmlFor:"attachments",className:"flex cursor-pointer items-center gap-2 text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:[e.jsx(Q,{className:"h-4 w-4"}),t("tickets.attachFiles")]})]}),i.attachments.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:i.attachments.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-2 dark:bg-gray-700",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"mr-2 h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:s.name})]}),e.jsx("button",{type:"button",onClick:()=>S(a),className:"text-gray-400 hover:text-red-500",children:e.jsx(N,{className:"h-4 w-4"})})]},a))})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"submit",disabled:p,className:"inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:opacity-50",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"mr-2 h-4 w-4 animate-spin",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),t("common.processing")]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),t("tickets.send")]})})})]})})]})}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",onClick:()=>h(null),children:e.jsx("div",{className:"max-h-[90vh] max-w-[90vw]",children:e.jsx("img",{src:g,alt:"Preview",className:"max-h-full max-w-full object-contain"})})}),((y=n.user.roles)==null?void 0:y.some(s=>s.name==="admin"))&&e.jsx("div",{className:"mt-4",children:e.jsx("select",{value:r.status,onChange:s=>{const a=s.target.value;z.post(route("tickets.update-status",r.id),{status:a},{preserveScroll:!0})},className:"rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:b.map(s=>e.jsx("option",{value:s,children:t(`tickets.status.${s}`)},s))})})]})}export{Z as default};
