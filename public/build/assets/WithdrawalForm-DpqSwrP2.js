import{u as q,r as x,a as T,j as e,y as g}from"./app-CgaCq9nv.js";import{c as j,N as V,P as $,A as w,B as H,J as N,H as M}from"./index-y9wjzvP5.js";import{m as R}from"./proxy-DFKnN-q_.js";import"./iconBase-5kt8W0gk.js";const _=o=>o.replace(/\s/g,"").replace(/(.{4})/g,"$1 ").trim(),v=o=>{const h=/^TR[0-9]{24}$/,b=o.replace(/\s/g,"").toUpperCase();if(!h.test(b))return!1;const i=(b.slice(4)+b.slice(0,4)).split("").map(r=>{const m=r.charCodeAt(0);return m>=65?m-55:r}).join("");let t="";for(let r=0;r<i.length;r++)t=t+i[r],t=(parseInt(t,10)%97).toString();return parseInt(t,10)===1},J=({exchangeRate:o,savedIbans:h,banks:b,onAmountChange:y,onProcessingChange:i})=>{const{t}=q(),[r,m]=x.useState(null),[I,p]=x.useState(!1),{data:s,setData:c,post:C,processing:f,errors:l}=T({amount_usd:"",type:"bank_withdrawal",bank_id:"",bank_account:"",customer_name:"",customer_surname:"",customer_meta_id:"",exchange_rate:o.toString()});x.useEffect(()=>{y(s.amount_usd)},[s.amount_usd,y]),x.useEffect(()=>{if(s.bank_account){const a=v(s.bank_account);m(a),p(!0)}else p(!1)},[s.bank_account]);const S=async()=>{try{const a=await navigator.clipboard.readText();k(a),g.success(t("withdrawal.ibanPasted"))}catch{g.error(t("withdrawal.pasteError"))}},k=(a,u=!1)=>{let n=a.replace(/[^A-Z0-9]/g,"").toUpperCase();if(n&&!n.startsWith("TR")&&(n="TR"+n),n.length>26&&(n=n.slice(0,26)),n.length===26){const d=v(n);m(d),p(!0),d?g.success(t("withdrawal.validIBAN")):g.error(t("withdrawal.invalidIBAN"))}else m(null),p(!1);c(d=>({...d,bank_account:n,bank_id:u?d.bank_id:d.bank_id||"",customer_name:u?d.customer_name:d.customer_name||"",customer_surname:u?d.customer_surname:d.customer_surname||""}))},F=a=>{c({...s,bank_id:a.bank_id,bank_account:a.iban,customer_name:a.name,customer_surname:a.surname,type:"bank_withdrawal",exchange_rate:o.toString()}),k(a.iban,!0)};x.useEffect(()=>{},[s]);const A=a=>{a.preventDefault(),i(!0),c("exchange_rate",o.toString()),C(route("withdrawal.store"),{onSuccess:()=>{i(!1),g.success(t("withdrawal.requestCreated"))},onError:()=>{i(!1),g.error(t("withdrawal.createError"))}})};x.useEffect(()=>{i(f)},[f,i]);const B=()=>h.map(a=>e.jsx("div",{onClick:()=>F(a),className:`cursor-pointer rounded-lg border p-4 transition-colors ${s.bank_account===a.iban?"border-indigo-500 bg-indigo-50 dark:border-indigo-400 dark:bg-indigo-900/20":"border-gray-200 hover:border-indigo-500 dark:border-gray-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"rounded-full bg-blue-100 p-2 dark:bg-blue-900/20",children:e.jsx(w,{className:"h-5 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[a.bank_details.name,a.is_default&&e.jsxs("span",{className:"ml-2 text-xs text-indigo-600 dark:text-indigo-400",children:["(",t("common.default"),")"]})]}),e.jsx("div",{className:"font-mono text-sm text-gray-500 dark:text-gray-400",children:_(a.iban)}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[a.name," ",a.surname]})]})]}),s.bank_account===a.iban&&e.jsx(N,{className:"h-5 w-5 text-indigo-600"})]})},a.id)),E=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:t("withdrawal.accountInfo")}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-900 dark:text-gray-100",children:[t("withdrawal.customerMetaId"),e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"customer_meta_id",value:s.customer_meta_id,onChange:a=>{const u=a.target.value;(u===""||/^\d+$/.test(u))&&c("customer_meta_id",u)},onKeyPress:a=>{!/[\d]/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Delete"&&a.key!=="ArrowLeft"&&a.key!=="ArrowRight"&&a.preventDefault()},className:"block w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700",placeholder:t("withdrawal.customerMetaIdPlaceholder"),required:!0}),l.customer_meta_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.customer_meta_id}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t("withdrawal.customerMetaIdHelp")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-900 dark:text-gray-100",children:t("withdrawal.accountHolderName")}),e.jsx("input",{type:"text",name:"customer_name",value:s.customer_name,onChange:a=>c("customer_name",a.target.value),className:"block w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700",required:!0}),l.customer_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.customer_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-900 dark:text-gray-100",children:t("withdrawal.accountHolderSurname")}),e.jsx("input",{type:"text",name:"customer_surname",value:s.customer_surname,onChange:a=>c("customer_surname",a.target.value),className:"block w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700",required:!0}),l.customer_surname&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.customer_surname})]})]});return e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"overflow-hidden rounded-lg bg-white p-6 shadow-sm dark:bg-gray-800",children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-900 dark:text-gray-100",children:[t("withdrawal.amount")," (USD)",e.jsx("span",{className:"ml-2 text-xs font-normal text-amber-600 dark:text-amber-400",children:t("withdrawal.usdOnly")})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(j,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"number",step:"0.01",min:"1",value:s.amount_usd,onChange:a=>c("amount_usd",a.target.value),className:"block w-full rounded-lg border-gray-300 pl-10 pr-16 focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700",required:!0,placeholder:"0.00"}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"USD"})})]}),l.amount_usd&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.amount_usd}),e.jsx("div",{className:"mt-2 rounded-lg bg-blue-50 p-3 dark:bg-blue-900/20",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(V,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-blue-500 dark:text-blue-400"}),e.jsx("p",{className:"ml-2 text-sm text-blue-700 dark:text-blue-300",children:t("withdrawal.usdOnlyInfo")})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-900 dark:text-gray-100",children:t("withdrawal.selectBank")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx($,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("select",{value:s.bank_id,onChange:a=>c("bank_id",a.target.value),className:"block w-full rounded-lg border-gray-300 pl-10 focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700",required:!0,children:[e.jsx("option",{value:"",children:t("common.select")}),b.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),l.bank_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.bank_id})]}),h.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-900 dark:text-gray-100",children:t("withdrawal.savedIbans")}),e.jsx("div",{className:"space-y-3",children:B()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-900 dark:text-gray-100",children:t("withdrawal.manualIban")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(w,{className:`h-5 w-5 ${r===!0?"text-green-500":r===!1?"text-red-500":"text-gray-400"}`})}),e.jsx("input",{type:"text",value:_(s.bank_account),onChange:a=>k(a.target.value),className:`block w-full rounded-lg border pl-10 pr-20 uppercase focus:ring-2 ${r===!0?"border-green-500 focus:border-green-500 focus:ring-green-200":r===!1?"border-red-500 focus:border-red-500 focus:ring-red-200":"border-gray-300 focus:border-indigo-500 focus:ring-indigo-200"} dark:border-gray-600 dark:bg-gray-700`,placeholder:"TR00 0000 0000 0000 0000 0000 00",required:!0}),e.jsxs("button",{type:"button",onClick:S,className:"absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 hover:text-gray-700",children:[e.jsx(H,{className:"mr-1 h-4 w-4"}),t("common.paste")]})]}),I&&e.jsx("div",{className:"mt-2 flex items-center space-x-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-500",children:t("withdrawal.validIBAN")})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-500",children:t("withdrawal.invalidIBAN")})]})}),l.bank_account&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.bank_account})]}),E(),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:f||!s.amount_usd||!s.bank_id||!s.bank_account,className:"inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:opacity-50",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"mr-2 h-4 w-4 animate-spin",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),t("common.processing")]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),t("withdrawal.submit")]})})})]})})};export{J as WithdrawalForm};
